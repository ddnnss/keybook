{% extends 'basic.html' %}
{% load static %}
{% block title %}
    {{ block.super }} - Просмотр предложения
{% endblock %}


{% block content %}
{% include 'header-no-bg.html' %}
   <section class="page-header">
    <div class="page-header-inner">
         <div class="page-header-inner-header">
           <h1>{{ house.name }}</h1>
            <p>{{ house.price }} ₽ / сутки</p>

        </div>

        <ul class="breadcrumbs">
            <li><a href="/">главная</a></li>
            <li>{{ house.name }}</li>
        </ul>
    </div>
</section>
    <section class="product-owner">
        <div class="container product-owner-inner">
            <div class="product-owner-info">
                 <img style="width: 50px;height: 50px" src="{{ house.client.get_avatar }}" alt="">
                <p>
                    {{ house.client.fio }}
                <b>&#9733;</b>
                <span>4.4</span>
                </p>
            </div>
            <div class="product-owner-buttons">
                <a href="#">НАПИСАТЬ ВЛАДЕЛЬЦУ</a>
                <a href="#">ПОКАЗАТЬ НА КАРТЕ</a>
                {% if  request.user.is_authenticated and not house.id in allfavs %}
                <a style="cursor: pointer" onclick="addfav({{ house.id }})">В ИЗБРАННОЕ</a>
                    {% else %}
                    <a style="cursor: no-drop" >В ИЗБРАННОМ</a>
                {% endif %}
                <a onclick="rent()">ЗАБРОНИРОВАТЬ</a>
            </div>


        </div>

    </section>

    <section class="product">
        <div class="container product-inner">
            <div class="product-image">

                {% for image in house.housephotos_set.all %}
                    {% if forloop.counter == 1 %}

                        <img src=" {{ image.image.url }}">
                    {% endif %}
                     <img class="product-image-thumb" src=" {{ image.image.url }}">
                {% endfor %}


            </div>
            <div style="align-items: start" class="product-calendar wrapper ">
     {% if  request.user.is_authenticated %}
                <select style="width: 100%;
  height: 50px;
  border: 1px solid #c4c4c4;
  padding: 5px 10px;
  font: 14px 'Montserrat Bold',sans-serif;
  color: #c4c4c4;
  text-transform: uppercase;
  text-align: center;"  id="mon" onchange="checkDays(this)">
                <option selected disabled>Выберите месяц</option>
                    {% for k,v in months.items %}
                        <option value="{{ v }}">{{ k }}</option>
                    {% endfor %}

                </select>
            <select style="width: 100%;
  height: 50px;
  border: 1px solid #c4c4c4;
  padding: 5px 10px;
  font: 14px 'Montserrat Bold',sans-serif;
  color: #c4c4c4;
  text-transform: uppercase;
  text-align: center;" id="day">
             <option selected disabled>Выберите день</option>
                    {% for i in days %}

                        {% if not forloop.counter == 1 %}
                         <option class="dayyysss" id="day-{{ i }}" value="{{ i }}">{{ i }}</option>
                        {% endif %}
                    {% endfor %}

                </select>
            {% endif %}

            </div>
        </div>
    </section>
    <section class="product-info">
        <div class="container product-info-inner">
            <div class="product-info-inner-left">
             <p class="filter-separator full-row">основные данные объекта</p>

            <input style="background: #fff" type="text" class="full-row" disabled  value="{{ house.client.fio }}">
            <input style="background: #fff" type="text"  disabled value="GMT+3">
            <input style="background: #fff" type="text"  disabled value="{{ house.address }}">
           <textarea style="background: #fff" class="full-row" disabled placeholder="напишите тут о своих интересах и увлечениях">{{ house.info }}</textarea>

        </div>
            <div class="product-info-inner-right">
                 <p class="filter-separator full-row">другие параметры</p>

                {% for filter in filterValues %}
                    {% if filter.value  %}
                    <p class="filter-info"> {{ filter.filter.name }} : {{ filter.value }}</p>
                     {% elif filter.boolValue %}
                    <p class="filter-info"> {{ filter.filter.name }} : ДА</p>
                    {% else %}
                        <p class="filter-info"> {{ filter.filter.name }} : НЕТ</p>
                    {% endif %}
                {% endfor %}



        </div>

        </div>

    </section>

<script>


    function addfav(id) {
        window.location.replace(`/addfav/${id}`);
    }

let rentDays={}
var arr=[]
    {% for x in rentdays %}
        cM = '{{ x.month }}'
        if (cM in rentDays){
            arr.push({{ x.day }})
            rentDays['{{ x.month }}']=arr
    }
    else {
            arr=[]
            cM = '{{ x.month }}'
            arr.push({{ x.day }})
            rentDays['{{ x.month }}']=arr
        }





    {% endfor %}
  console.log(rentDays)

function checkDays(el) {
        allD = document.getElementsByClassName('dayyysss')

        for (x of allD){
              console.log(x)
              x.disabled = false
            console.log(x)
        }
      let curM = el.options[el.selectedIndex].text
    console.log(el.options[el.selectedIndex].text)
    if (curM in rentDays){



        console.log( rentDays[curM])
        for (x of rentDays[curM]) {
            console.log(x)
            document.getElementById(`day-${x}`).disabled = true
        }
    }
}

function rent() {
    var h = {{ house.id }}
    var whh = {{ house.client.id }}
    var m = document.getElementById("mon");
    var mon = m.options[m.selectedIndex].text;
     var d = document.getElementById("day");
    var day = d.options[d.selectedIndex].text;
    console.log(mon,day)
     window.location.replace(`/rent?m=${mon}&d=${day}&h=${h}&whh=${whh}`);
}
</script>

{% endblock %}